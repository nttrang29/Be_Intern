*** role_update_patch.diff
# Patch file generated by assistant — contains changes to support VIEW role and PATCH/PUT member updates
# Apply with: git apply role_update_patch.diff  (or review & copy manually)

diff --git a/backend/src/main/java/com/example/financeapp/wallet/controller/WalletController.java b/backend/src/main/java/com/example/financeapp/wallet/controller/WalletController.java
index b674b46..8c0a833 100644
--- a/backend/src/main/java/com/example/financeapp/wallet/controller/WalletController.java
+++ b/backend/src/main/java/com/example/financeapp/wallet/controller/WalletController.java
@@ -27,6 +27,9 @@ import org.springframework.security.core.context.SecurityContextHolder;
 import org.springframework.web.bind.annotation.*;
 
 import java.util.*;
+import com.example.financeapp.wallet.entity.WalletMember;
+import com.example.financeapp.wallet.repository.WalletMemberRepository;
+import com.example.financeapp.wallet.dto.response.WalletMemberDTO;
@@ -39,6 +42,9 @@ public class WalletController {
     @Autowired
     private UserRepository userRepository;
 
+    @Autowired
+    private WalletMemberRepository walletMemberRepository;
+
@@ -100,8 +106,13 @@ public class WalletController {
         try {
             Long userId = getCurrentUserId();
             Wallet wallet = walletService.getWalletDetails(userId, walletId);
+            // Determine current user's role in this wallet
+            String role = walletMemberRepository.findByWallet_WalletIdAndUser_UserId(walletId, userId)
+                .map(m -> m.getRole().toString())
+                .orElse("NONE");
 
             res.put("wallet", wallet);
+            res.put("role", role);
             return ResponseEntity.ok(res);
@@ -168,6 +179,55 @@ public class WalletController {
         }
     }
 
+        @RequestMapping(value = "/{walletId}/members/{memberUserId}", method = {RequestMethod.PUT, RequestMethod.PATCH})
+        public ResponseEntity<Map<String, Object>> updateMemberRole(
+            @PathVariable Long walletId,
+            @PathVariable Long memberUserId,
+            @RequestBody Map<String, String> body) {
+
+        Map<String, Object> res = new HashMap<>();
+
+        String role = body != null ? body.get("role") : null;
+        if (role == null || role.isBlank()) {
+            res.put("error", "Trường 'role' bắt buộc");
+            return ResponseEntity.badRequest().body(res);
+        }
+
+        try {
+            Long operatorId = getCurrentUserId();
+            walletService.updateMemberRole(walletId, operatorId, memberUserId, role);
+
+            // Fetch updated member and return DTO
+            WalletMember updated = walletMemberRepository
+                .findByWallet_WalletIdAndUser_UserId(walletId, memberUserId)
+                .orElseThrow(() -> new RuntimeException("Thành viên không tồn tại sau khi cập nhật"));
+
+            WalletMemberDTO dto = new WalletMemberDTO(
+                updated.getMemberId(),
+                updated.getUser().getUserId(),
+                updated.getUser().getFullName(),
+                updated.getUser().getEmail(),
+                updated.getUser().getAvatar(),
+                updated.getRole().toString(),
+                updated.getJoinedAt()
+            );
+
+            res.put("member", dto);
+            res.put("message", "Cập nhật quyền thành công");
+            return ResponseEntity.ok(res);
+
+        } catch (IllegalArgumentException ex) {
+            res.put("error", ex.getMessage());
+            return ResponseEntity.badRequest().body(res);
+        } catch (org.springframework.security.access.AccessDeniedException ex) {
+            res.put("error", ex.getMessage());
+            return ResponseEntity.status(403).body(res);
+        } catch (Exception ex) {
+            res.put("error", "Lỗi máy chủ nội bộ: " + ex.getMessage());
+            return ResponseEntity.status(500).body(res);
+        }
+    }
+
     @DeleteMapping("/{walletId}/members/{memberUserId}")
     public ResponseEntity<Map<String, Object>> removeMember(
             @PathVariable Long walletId, @PathVariable Long memberUserId) {
@@ -215,11 +275,17 @@ public class WalletController {
         Long userId = getCurrentUserId();
 
         boolean hasAccess = walletService.hasAccess(walletId, userId);
-        boolean isOwner = walletService.isOwner(walletId, userId);
-
         res.put("hasAccess", hasAccess);
-        res.put("isOwner", isOwner);
-        res.put("role", isOwner ? "OWNER" : (hasAccess ? "MEMBER" : "NONE"));
+
+        String role = "NONE";
+        if (hasAccess) {
+            role = walletMemberRepository.findByWallet_WalletIdAndUser_UserId(walletId, userId)
+                    .map(m -> m.getRole().toString())
+                    .orElse("NONE");
+        }
+
+        res.put("role", role);
+        res.put("isOwner", "OWNER".equals(role));
 
         return ResponseEntity.ok(res);
     }
diff --git a/backend/src/main/java/com/example/financeapp/wallet/dto/response/SharedWalletDTO.java b/backend/src/main/java/com/example/financeapp/wallet/dto/response/SharedWalletDTO.java
index dbcd02f..79d600d 100644
--- a/backend/src/main/java/com/example/financeapp/wallet/dto/response/SharedWalletDTO.java
+++ b/backend/src/main/java/com/example/financeapp/wallet/dto/response/SharedWalletDTO.java
@@ -85,6 +85,11 @@ public class SharedWalletDTO {
         this.myRole = myRole;
     }
 
+    @com.fasterxml.jackson.annotation.JsonProperty("role")
+    public String getRole() {
+        return this.myRole;
+    }
+
     public Long getOwnerId() {
         return ownerId;
     }
diff --git a/backend/src/main/java/com/example/financeapp/wallet/entity/WalletMember.java b/backend/src/main/java/com/example/financeapp/wallet/entity/WalletMember.java
index 23750cf..e07f7ed 100644
--- a/backend/src/main/java/com/example/financeapp/wallet/entity/WalletMember.java
+++ b/backend/src/main/java/com/example/financeapp/wallet/entity/WalletMember.java
@@ -34,7 +34,8 @@ public class WalletMember {
     // Enum cho roles
     public enum WalletRole {
         OWNER,   // Chủ sở hữu ví
-        MEMBER   // Thành viên được chia sẻ
+        MEMBER,  // Thành viên được chia sẻ
+        VIEW     // Chỉ quyền xem
     }
 
     // Constructors
diff --git a/backend/src/main/java/com/example/financeapp/wallet/service/WalletService.java b/backend/src/main/java/com/example/financeapp/wallet/service/WalletService.java
index ce5def0..16d4987 100644
--- a/backend/src/main/java/com/example/financeapp/wallet/service/WalletService.java
+++ b/backend/src/main/java/com/example/financeapp/wallet/service/WalletService.java
@@ -43,6 +43,15 @@ public interface WalletService {
     void leaveWallet(Long walletId, Long userId);
 
+    /**
+     * Cập nhật role cho một thành viên trong wallet.
+     * @param walletId id của wallet
+     * @param operatorUserId id của user thực hiện thay đổi (từ token)
+     * @param memberUserId id của thành viên bị thay đổi
+     * @param role giá trị role mới (OWNER hoặc MEMBER)
+     */
+    void updateMemberRole(Long walletId, Long operatorUserId, Long memberUserId, String role);
+
     boolean hasAccess(Long walletId, Long userId);
 
     boolean isOwner(Long walletId, Long userId);
diff --git a/backend/src/main/java/com/example/financeapp/wallet/service/impl/WalletServiceImpl.java b/backend/src/main/java/com/example/financeapp/wallet/service/impl/WalletServiceImpl.java
index e2651ee..37b95bd 100644
--- a/backend/src/main/java/com/example/financeapp/wallet/service/impl/WalletServiceImpl.java
+++ b/backend/src/main/java/com/example/financeapp/wallet/service/impl/WalletServiceImpl.java
@@ -225,6 +225,55 @@ public class WalletServiceImpl implements WalletService {
         walletMemberRepository.delete(member);
     }
 
+    @Override
+    @Transactional
+    public void updateMemberRole(Long walletId, Long operatorUserId, Long memberUserId, String role) {
+
+        // Kiểm tra operator là owner
+        if (!isOwner(walletId, operatorUserId)) {
+            throw new org.springframework.security.access.AccessDeniedException("Chỉ chủ sở hữu mới có thể thay đổi quyền thành viên");
+        }
+
+        // Không cho phép thay đổi quyền của chính mình (tránh mất quyền truy cập)
+        if (operatorUserId.equals(memberUserId)) {
+            throw new IllegalArgumentException("Không thể thay đổi quyền của chính bạn");
+        }
+
+        WalletMember target = walletMemberRepository
+                .findByWallet_WalletIdAndUser_UserId(walletId, memberUserId)
+                .orElseThrow(() -> new IllegalArgumentException("Thành viên không tồn tại trong ví"));
+
+        WalletMember.WalletRole newRole;
+        try {
+            newRole = WalletMember.WalletRole.valueOf(role.toUpperCase());
+        } catch (Exception ex) {
+            throw new IllegalArgumentException("Vai trò không hợp lệ. Giá trị hợp lệ: OWNER, MEMBER, VIEW");
+        }
+
+        // Nếu target hiện là OWNER và yêu cầu hạ quyền (không phải thông qua transfer ownership), chặn lại
+        if (target.getRole() == WalletMember.WalletRole.OWNER && newRole != WalletMember.WalletRole.OWNER) {
+            throw new IllegalArgumentException("Không thể hạ quyền OWNER trực tiếp. Hãy chuyển OWNER cho thành viên khác nếu cần.");
+        }
+
+        if (newRole == WalletMember.WalletRole.OWNER) {
+            // Promote: hạ owner cũ xuống MEMBER, rồi nâng target lên OWNER
+            walletMemberRepository.findByWallet_WalletIdAndRole(walletId, WalletMember.WalletRole.OWNER)
+                    .ifPresent(oldOwner -> {
+                        if (!oldOwner.getUser().getUserId().equals(target.getUser().getUserId())) {
+                            oldOwner.setRole(WalletMember.WalletRole.MEMBER);
+                            walletMemberRepository.save(oldOwner);
+                        }
+                    });
+
+            target.setRole(WalletMember.WalletRole.OWNER);
+            walletMemberRepository.save(target);
+        } else {
+            // Đặt thành MEMBER hoặc VIEW
+            target.setRole(newRole);
+            walletMemberRepository.save(target);
+        }
+    }
+
     // ---------------- UPDATE WALLET (NEW STYLE) ----------------
     @Override
     @Transactional
*** End Patch
